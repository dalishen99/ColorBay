## Token激励计划合约


#### 功能说明

实现多个投资人或员工的Token激励计划，在一定时间内锁仓，锁仓期过后分期释放到投资人或员工钱包账号，支持项目方回收Token。

![](http://p7mdpxh8m.bkt.clouddn.com/github/img/shifang.jpg)

如图，激励计划分为锁仓期、释放期。在合约中添加一个激励计划，可以指定投资人或员工的钱包地址、开始锁定时间点、开始释放时间点、释放分几期、释放完成时间点等参数，时间精确到秒，Token数精确到wei，锁仓期内投资人或员工不能将Token转出，从开始释放时间点逐期释放，如果Token数或释放时间除以释放分期数有余数，则余数部分的Token将在释放完成时间的最后一秒时（上图：释放时间点3）释放。
如果员工离职，激励计划可以由项目方中止，员工拿到应得Token，项目方撤回承诺员工的剩余Token。

---

#### 测试功能点：

添加token激励计划、token锁仓、token按阶段释放、token在锁仓/释放/结束阶段回收

---

#### 测试工具
Remix或Truffle

---

#### 测试数据

**代币**
- 彩贝发行总量为 1,000,000,000 个token
- 机构方私募                   占比15%，即150,000,000个token，上交易所后私募锁仓三个月，之后逐月释放 20%；
- 基金会核心运作团队            占比20%，即200,000,000个token，锁定一年， 两年内逐步释放；
- 社区建设&海外社区核心团队     占比10%，即100,000,000个token，锁定一年，两年内逐步释放；
- 生态激励矿池                 占比30%，即300,000,000个token，按照智能合约的规则每年释放剩余总量的 10%；
- 市场推广                     占比15%，即150,000,000个token，主要是市场教育、社区推广等持续性投入；
- 基金会持有                   占比10%，即100,000,000个token，，主要做数字内容生态战略合作资源。

---
**账号**
管理员 0xca3...a733c
张三 0x147...c160c
李四 0x4b0...4d2db
王五 0x583...40225
赵六 0xdd8...92148

---

管理员 0xca35b7d915458ef540ade6068dfe2f44e8fa733c
张三 0x14723a09acff6d2a60dcdf7aa4aff308fddc160c
李四 0x4b0897b0513fdc7c541b6d9d7e929c4e5364d2db
王五 0x583031d1113ad414f02576bd6afabfb302140225
赵六 0xdd870fa1b7c4700f2bd7f44238821c26f7392148


#### 用例1——创建代币合约Colorbay与激励合约TokenVesting

1、创建代币合约Colorbay

切换到管理员账号`0xca3...a733c`下，创建代币合约Colorbay，创建完成后，复制合约地址备用：
```
0x692a70d2e424a56d2c6c27aa97d1a86395877b3a
```

2、创建激励合约TokenVesting

切换到管理员账号`0xca3...a733c`下，创建激励合约。输入CLB合约地址:
```
constructor("0x692a70d2e424a56d2c6c27aa97d1a86395877b3a")
```
复制激励合约地址备用：
```
0xbbf289d846208c16edc8474705c748aff07732db
```

3、切换到CLB合约和管理员账号`0xca3...a733c`下，给激励合约转账10000个CLB，为张三的激励计划做准备：
```
transfer("0xbbf289d846208c16edc8474705c748aff07732db", "10000,000000000000000000") //约定：运行时，去除数额中的逗号，否则会出错
```

#### 用例2——给私募投资人张三分配10000个CLB，锁仓10分钟，分2次释放，释放持续时间为20分钟，直到释放完成

1、回到激励合约，添加一个激励计划：
假设张三的激励计划为：从2018/08/31 10:00:00[1535644800]开始锁仓到10:10，释放分为2个时间阶段（10:20，10:30），10:30时释放完成10000个CLB，CLB不可回收，备注信息为：上交易所后私募锁仓10分钟，之后每10分钟释放50%。
[点我快速生成参数>>](http://api.ju3ban.net/test.php?startTime=2018/08/31%2010:00:00)
```
addPlan("0x14723a09acff6d2a60dcdf7aa4aff308fddc160c", "1535644800", "1535681400", 2, "1535682600", "10000,000000000000000000", false, "上交易所后私募锁仓10分钟，之后每10分钟释放50%")
```

2、查看张三的释放计划
```
plans("0x14723a09acff6d2a60dcdf7aa4aff308fddc160c") //查看张三当前的释放数量为0
```

3、在锁仓阶段的10:09:59或第一个释放阶段未到10:19:59时[1535681399]，张三试图去释放自己的激励，切换到张三账号`0x147...c160c`下：
```
setBlockTimestamp(1535681399)

release("0x14723a09acff6d2a60dcdf7aa4aff308fddc160c") //此时释放数量应该为0
```

4、在释放阶段的10:20:00时[1535682000]（或之后），重复第3步操作：
```
setBlockTimestamp(1535682000)

release("0x14723a09acff6d2a60dcdf7aa4aff308fddc160c") //张三应该拿到5000个CLB
```

5、查询张三的到账情况
```
balanceOf("0x14723a09acff6d2a60dcdf7aa4aff308fddc160c")
```

6、在释放阶段的10:30:01[1535682601]时（即释放结束时间）（或之后），重复第3步操作，张三应该拿到了10000个CLB
```
setBlockTimestamp(1535682601)

release("0x14723a09acff6d2a60dcdf7aa4aff308fddc160c") //张三应该拿到5000个CLB
```

7、重复第5步，张三应该拿到了10000个的CLB（即全部CLB）

---

#### 用例3——给私募投资人李四分配10000个CLB，锁仓10分钟，分2次释放，释放持续时间为21分钟1秒，直到释放完成

2、回到激励合约，添加一个激励计划：
假设李四的激励计划为：从2018/08/31 10:00:00[1535644800]开始锁仓到10:10[1535681400]，释放分为2个时间阶段（10:20:30，10:31:01）[1535682000, 1535682661]，10:35 [1535682900]时释放完成10000个CLB，CLB不可回收，备注信息为：上交易所后私募锁仓10分钟，之后每10分钟释放50%。

```
//先设置回时间，往智能合约地址打币
transfer("0xbbf289d846208c16edc8474705c748aff07732db", "10000,000000000000000000") //约定：运行时，去除数额中的逗号，否则会出错

setBlockTimestamp(1535644000)

addPlan("0x4b0897b0513fdc7c541b6d9d7e929c4e5364d2db","1535644800", "1535681400", 2, "1535682661", "10000,000000000000000000", false, "上交易所后私募锁仓10分钟，之后每10分钟释放50%。")
```

3、在锁仓阶段的10:09:59[1535680740]时（或之前），李四试图去释放自己的激励，切换到李四账号`0x4b0...4d2db`下：
```
release() //此时释放数量应该为0
```

4、查看李四的释放计划
```
plans("0x4b0897b0513fdc7c541b6d9d7e929c4e5364d2db") //查看张三当前的释放数量为0
```

5、在释放阶段的10:20:32[1535682032]（或之后），李四试图去释放自己的激励，切换到李四账号`0x4b0...4d2db`下，重复第3步操作，李四应该拿到5000个CLB

6、在释放阶段的10:31:05[1535682665]（即释放结束时间）（或之后），管理员试图去释放李四的激励，切换到管理员账号`0xca35b7d915458ef540ade6068dfe2f44e8fa733c`下， 重复第3步操作，李四应该拿到了10000个CLB

---

#### 用例4——给员工王五分配10000个CLB，锁仓10分钟，分3次释放，释放持续时间为31分钟1秒，直到释放完成

1、重复用例1

2、回到激励合约，添加一个激励计划：
假设王五的激励计划为：从2018/08/31 10:00:00[1535644800]开始锁仓到10:10[1535681400]，释放分为3个时间阶段（10:20:20、10:30:40、10:41:01）[1535682020， 1535682640, 1535683261]，10:41:01时释放完成10000个CLB（每次释放3333个，最后一次3334个），CLB可回收，备注信息为：上交易所后私募锁仓10分钟，之后每10分钟释放33.33%，余下的1个CLB在第3个时间段的最后一秒钟后一起释放。
```
//先设置回时间，往智能合约地址打币
transfer("0xbbf289d846208c16edc8474705c748aff07732db", "10000,000000000000000000") //约定：运行时，去除数额中的逗号，否则会出错

setBlockTimestamp(1535644000)

addPlan("0x583031d1113ad414f02576bd6afabfb302140225", "1535644800", "1535681400", 3, "1535683261", "10000,000000000000000000", true, "上交易所后私募锁仓10分钟，之后每10分钟释放33.33%，余下的1个CLB在第3个时间段的最后一秒钟后一起释放。")
```

3、在10:20:21[1535682012]时（或之后），王五试图去释放自己的激励
```
setBlockTimestamp(1535682021)

release("0x583031d1113ad414f02576bd6afabfb302140225") //此时应该为3333,333333333333333333个CLB
```

4、在10:30:40 [1535682640]时（或之后），张三试图帮王五释放王五的激励
```
setBlockTimestamp(1535682640)

release("0x583031d1113ad414f02576bd6afabfb302140225") //此时应该为3333,333333333333333333个CLB
```

5、在10:41:00时（或之后），张三试图帮王五释放王五的激励,未释放成功 【！！竟然释放完了】
```
setBlockTimestamp(1535683260)

release("0x583031d1113ad414f02576bd6afabfb302140225") //此时应该为3333,333333333333333334个CLB
```

5、在10:41:03时（或之后），王五释放完成自己的所有激励，包括余下的1个CLB
```
setBlockTimestamp(1535683263)

release("0x583031d1113ad414f02576bd6afabfb302140225") //此时应该为3333,333333333333333334个CLB
```

6、查看王五的释放计划
```
plans("0x583031d1113ad414f02576bd6afabfb302140225")
```

7、查看激励合约余额、资金池
```
thisTokenBalance() //此时应该是0
payPool() //此时应该是0
```

---

#### 用例5——给员工赵六分配10000个CLB，锁仓10分钟，分2次释放，释放持续时间为21分钟1秒，赵六在未到第一个释放阶段时离职，管理员在锁仓期间回收所有Token

1、重复用例1

2、回到激励合约，添加一个激励计划：
假设赵六的激励计划为：从2018/08/31 10:00:00开始锁仓到10:10，释放分为2个时间阶段（10:20:30，10:31:01），10:31:01时释放完成10001个CLB，CLB可回收，备注信息为：上交易所后私募锁仓10分钟，之后每10分钟释放50%。
```
addPlan("0xdd870fa1b7c4700f2bd7f44238821c26f7392148", "1535644800", "1535681400", 2, "1535682661", "10000,000000000000000000", true, "上交易所后私募锁仓10分钟，之后每10分钟释放50%。")
```

3、在10:20:29时（或之前），赵六离职，管理员回收CLB，切换到管理员账号`0xca3...a733c`下：
```
revoke() //此时回收数量应该为赵六的全部CLB，10000个
```

4、查看赵六的释放计划，已经被回收状态
```
plans("0xdd870fa1b7c4700f2bd7f44238821c26f7392148") //此时张三的计划显示isRevoked的值为true，表示已经被回收
```

5、查看激励合约余额、资金池
```
thisTokenBalance() //此时应该是0
payPool() //此时应该是0
```

6、回到CLB合约，查看管理员的余额，切换到管理员账号`0xca3...a733c`下：
```
balanceOf("0xca35b7d915458ef540ade6068dfe2f44e8fa733c") //此时应该增加10000个CLB
```

---

#### 用例6——给员工张三分配10000个CLB，锁仓10分钟，分3次释放，释放持续时间为31分钟1秒，张三在刚到第一个释放阶段时离职，管理员回收未释放Token

1、重复用例1

2、回到激励合约，添加一个激励计划：
假设张三的激励计划为：从2018/08/31 10:00:00开始锁仓到10:10，释放分为3个时间阶段（10:20:20、10:30:40、10:41:01），10:41:01时释放完成10000个CLB（每次释放3333个，最后一次3334个），CLB可回收，备注信息为：上交易所后私募锁仓10分钟，之后每10分钟释放33.33%，余下的1个CLB在第3个时间段的最后一秒钟后一起释放。
```
addPlan("0x14723a09acff6d2a60dcdf7aa4aff308fddc160c", "1535644800", "1535681400", 3, "1535683261", "10000,000000000000000000", true, "上交易所后私募锁仓10分钟，之后每10分钟释放33.33%，余下的1个CLB在第3个时间段的最后一分钟后一起释放。")
```

3、在10:20:20时（即刚到第一个释放阶段）（或之后），张三离职，主动去释放操作了一次（务必操作，否则在管理员执行回收操作后无法取回应得部分）
```
release() //此时应该为3333,333333333333333333个CLB
```
4、然后管理员回收CLB（在张三离职后操作均可），切换到管理员账号`0xca3...a733c`下：
```
revoke() //此时回收数量应该为6666,666666666666666667个CLB
```

5、查看张三的释放计划，已经被回收状态
```
plans("0x14723a09acff6d2a60dcdf7aa4aff308fddc160c") //此时张三的计划显示isRevoked的值为true，表示已经被回收
```

6、查看激励合约余额、资金池
```
thisTokenBalance() //此时应该是0
payPool() //此时应该是0
```

7、回到CLB合约，查看管理员的余额，切换到管理员账号`0xca3...a733c`下：
```
balanceOf("0xca35b7d915458ef540ade6068dfe2f44e8fa733c") //此时应该增加6666,666666666666666667个CLB
```


要测试一个锁定时间等于开始时间的。

