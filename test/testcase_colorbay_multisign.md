# 多签合约ColorbayMultiSign测试用例
#### 测试功能点：创建多签合约、发起待审批事务、通过审批事务、撤消审批事务、执行已通过事务、增加审批委员会成员、删除审批委员会成员、替换审批委员会成员、更新审批确认个数、查询我的事务是否已经审批通过、查询当前系统的事务数量、查询审批委员会名单、查询我的事务当前已经确认通过的名单、查询当前系统的事务详情

---

#### 测试工具
Remix或Truffle

---

#### 测试数据
**代币**
- 彩贝发行总量为 1,000,000,000 个token
- 激励          占比35%，即350,000,000个token
- 私募          占比20%，即200,000,000个token
- 团队及基金会    占比25%，即250,000,000个token
- 社区培养及推广  占比20%，即200,000,000个token

---
**账号**

审批委员会成员：
- 管理员 `0xca3...a733c`
- 张三  `0x147...c160c`
- 李四  `0x4b0...4d2db`
- 王五  `0x583...40225`

申请人：
- 赵六  `0xdd8...92148`

---


- 管理员 `0xca35b7d915458ef540ade6068dfe2f44e8fa733c`
- 张三  `0x14723a09acff6d2a60dcdf7aa4aff308fddc160c`
- 李四  `0x4b0897b0513fdc7c541b6d9d7e929c4e5364d2db`
- 王五  `0x583031d1113ad414f02576bd6afabfb302140225`
- 赵六  `0xdd870fa1b7c4700f2bd7f44238821c26f7392148`

---

#### 用例1——创建多签合约

1、创建代币合约Colorbay

切换到管理员账号`0xca3...a733c`下，创建代币合约Colorbay，创建完成后，复制合约地址备用：
```
0x692a70d2e424a56d2c6c27aa97d1a86395877b3a
```

2、创建多签合约

切换到管理员账号`0xca3...a733c`下，创建多签合约。输入CLB合约地址，将审批委员会名单导入（`管理员、张三、李四、王五`），配置需要`4`个确认个数（也称必签数，即需要审批4次才能通过）
```
constructor("0x692a70d2e424a56d2c6c27aa97d1a86395877b3a", ["0xca35b7d915458ef540ade6068dfe2f44e8fa733c","0x14723a09acff6d2a60dcdf7aa4aff308fddc160c","0x4b0897b0513fdc7c541b6d9d7e929c4e5364d2db","0x583031d1113ad414f02576bd6afabfb302140225"], "4")
```

如果必签数<委员会成员数，将不能完成任何事务的审批，必须通过新增委员会成员（见用例8）才能完成

将多签合约地址复制下来备用：
```
0xbbf289d846208c16edc8474705c748aff07732db
```

3、给多签合约地址充值CLB

回到CLB合约中，切换到管理员账号`0xca3...a733c`下，给多签合约地址充值`2000000`CLB
```
transfer("0xbbf289d846208c16edc8474705c748aff07732db", "2000000,000000000000000000") #约定：运行时，去除数额中的逗号，否则会出错
```

4、查询多签合约地址代币余额

```
balanceOf("0xbbf289d846208c16edc8474705c748aff07732db")
```

5、查询剩余发行总量

```
balanceOf("0xca35b7d915458ef540ade6068dfe2f44e8fa733c")
```

#### 用例2——查询多签合约基本情况

1、查询当前审批需要多少个确认个数

```
required()
```

2、查询当前审批委员会名单

```
getOwners()
```

3、查询系统设定的审批委员会允许的最大个数

```
MAX_OWNER_COUNT()
```

4、查询某个地址是不是审批委员会成员

```
#张三
isOwner("0x14723a09acff6d2a60dcdf7aa4aff308fddc160c")
#赵六
isOwner("0xdd870fa1b7c4700f2bd7f44238821c26f7392148")
#ACCOUNT1未知账户
isOwner("0xd1f7922e8b78cbeb182250753ade8379d1e09949")
```

5、查询当前事务序号

从0,1,2,3,4...不断自增
```
transactionCount()
```

6、获取当前事务总数

```
# 审批中的事务总数
getTransactionCount(true, false)
# 审批中的事务总数
getTransactionCount(false, true)
# 全部事务总数
getTransactionCount(true, true)
```

7、当前代币合约地址

```
token()
```


#### 用例3——发起待审批事务

仅审批委员会成员可操作

1、作为申请人赵六`0xdd8...92148`，向管理员提出申请，需要`10000`个CLB做为活动运营激励。切换到管理员账号`0xca3...a733c`下（可以是任意审批委员会账号）

```
submitTransaction("0xdd870fa1b7c4700f2bd7f44238821c26f7392148", "10000,000000000000000000")
```
编号为0的事务申请提交完成后，即管理员已经审批通过了这个事务，待其他3个审批通过。

2、作为申请人赵六`0xdd8...92148`，直接自己发起待审批事务。切换到赵六账号`0xca3...a733c`下（任意非审批委员会账号），将会报错，因为普通用户不能发起待审批事务
```
submitTransaction("0xdd870fa1b7c4700f2bd7f44238821c26f7392148", "10000,0000000000000000000000")
```

3、查询当前编号为0的事务有几人审批确认了
```
getConfirmationCount(0)
```

4、查询当前编号为0的事务有哪些委员做审批确认了
```
getConfirmations(0)
```

#### 用例5——进入审批流程

1、编号为0的事务还需要3个审批确认，现在张三、李四开始审批编号为0的事务，分别切换到张三账号、李四账号`0xca3...a733c`下，
```
confirmTransaction(0)
```
张三再次审批将会报错，因为已经审批过了

重复用例3第3、4步

2、张三后悔了，想要撤销审批，切换到张三账号`0xca3...a733c`下：

```
revokeConfirmation(0)
```
重复用例3第3、4步

3、审批委员会说服了张三，切换到张三账号`0xca3...a733c`下，张三再次做审批通过操作：

重复用例5第1步

#### 用例6——完成最后1次审批，同时执行转账，结束事务

1、切换到王五账号`0x583...40225`下，完成最后1次审批确认，同时将执行转账操作（已经满足4次确认）

2、查询赵六到账情况

回到CLB合约，查询赵六账号`0xdd8...92148`余额
```
balanceOf("0xdd870fa1b7c4700f2bd7f44238821c26f7392148")
```

3、查询发行总量

重复用例1第5条

4、查询编号为0的事务是否已经处于完成状态

```
isConfirmed(0)
```

#### 用例7——删除审批委员会成员

说明：不管是在审批流程中操作，还是在审批结束后操作，移除成员时，遵循以下规则：
- 委员会成员最多数为100个；
- 如果必签的个数>委员会成员数，比如必签个数为4，委员会成员数为4，做删除1个成员操作后，那么必签个数会更新成=委员会成员数；
- 如果必签的个数<委员会成员数，比如必签个数为4，委员会成员数为5，做删除1个成员操作后，那么审批通过不受影响；
- 删除操作人必须是自己账号，就是自有自己能删除自己，否则就是中心化了。

1、删除张三`0x147...c160c`

```
removeOwner("0x14723a09acff6d2a60dcdf7aa4aff308fddc160c")
```

2、删除李四`0x4b0...4d2db`

```
removeOwner("0x4b0897b0513fdc7c541b6d9d7e929c4e5364d2db")
```

【增加审计委员会成员和替换审计委员会成员的函数删除，改为把代币CLB打回到创建智能合约账户】

### 用例8-- 
王五也离职了，但是他不肯自己删除审计委员会权限。老板决策把剩余代币打回到管理账号，结束该审计委员会工作和审批权限。
```
withdrawToken()
```


